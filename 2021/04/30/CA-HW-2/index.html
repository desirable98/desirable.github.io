<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>CA-HW-2 - Xinru Jia&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Xinru Jia&#039;s Blog"><meta name="msapplication-TileImage" content="/img/IMG_2210.JPG"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Xinru Jia&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="HW_2The assignment of HW_2.I will adjust the format and combine problem and solution to be more suitable for markdown, but you can get and edit it in Overleaf by the source file.And you can get my sou"><meta property="og:type" content="blog"><meta property="og:title" content="CA-HW-2"><meta property="og:url" content="https://desirable98.github.io/2021/04/30/CA-HW-2/"><meta property="og:site_name" content="Xinru Jia&#039;s Blog"><meta property="og:description" content="HW_2The assignment of HW_2.I will adjust the format and combine problem and solution to be more suitable for markdown, but you can get and edit it in Overleaf by the source file.And you can get my sou"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://desirable98.github.io/img/3.jpg"><meta property="article:published_time" content="2021-04-30T09:48:18.000Z"><meta property="article:modified_time" content="2021-05-05T08:09:24.987Z"><meta property="article:author" content="XinRu Jia"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/3.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://desirable98.github.io/2021/04/30/CA-HW-2/"},"headline":"Xinru Jia's Blog","image":["https://desirable98.github.io/img/3.jpg"],"datePublished":"2021-04-30T09:48:18.000Z","dateModified":"2021-05-05T08:09:24.987Z","author":{"@type":"Person","name":"XinRu Jia"},"description":"HW_2The assignment of HW_2.I will adjust the format and combine problem and solution to be more suitable for markdown, but you can get and edit it in Overleaf by the source file.And you can get my sou"}</script><link rel="canonical" href="https://desirable98.github.io/2021/04/30/CA-HW-2/"><link rel="alternate" href="/atom.xml" title="Xinru Jia&#039;s Blog" type="application/atom+xml"><link rel="icon" href="/img/IMG_2210.JPG"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/IMG_2210.JPG" alt="Xinru Jia&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/Home">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/img/3.jpg" alt="CA-HW-2"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-04-30T09:48:18.000Z" title="4/30/2021, 5:48:18 PM">2021-04-30</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-05-05T08:09:24.987Z" title="5/5/2021, 4:09:24 PM">2021-05-05</time></span><span class="level-item"><a class="link-muted" href="/categories/Computer-and-Intelligent-Processor-Architecture/">Computer and Intelligent Processor Architecture</a></span><span class="level-item">20 minutes read (About 2943 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">CA-HW-2</h1><div class="content"><h1 id="HW-2"><a href="#HW-2" class="headerlink" title="HW_2"></a><strong><strong>HW_2</strong></strong></h1><p>The assignment of <a target="_blank" rel="noopener" href="https://arch.cihlab.top/CAHW2_2020.pdf">HW_2</a>.<br>I will adjust the format and combine problem and solution to be more suitable for markdown, but you can get and edit it in Overleaf by the <a target="_blank" rel="noopener" href="https://arch.cihlab.top/CAHW2_2020.pdf">source file</a>.<br>And you can get my source code solution and commit file in <a target="_blank" rel="noopener" href="https://github.com/desirable98/Computer-and-Intelligent-Processor-Architecture/tree/master/HW_2_submit">github repo</a></p>
<span id="more"></span>
<blockquote>
<table>
<thead>
<tr>
<th align="left">Problem 1: Implement a simple RISC Core</th>
<th align="right">(2+5+8=15 Points)</th>
</tr>
</thead>
</table>
</blockquote>
<p>Using the following ISA and hardware architecture to compute $\mathbf{A} \cdot \mathbf{B} + \mathbf{C}$, where<br>$\mathbf{A}$, $\mathbf{B}$ and $\mathbf{C}$ are $8\times 8$ matrices.<br>Each element in them are signed integers with 8b length.<br><img src="hw2.png" alt="Simple RISC Instruction Set and Architecture"></p>
<h2 id="Problem-a"><a href="#Problem-a" class="headerlink" title="Problem(a)"></a>Problem(a)</h2><p> Write the entire assembly code for computation. (hints: 8 indexed vector register file is not sufficient for 8x8 matrix.)</p>
<h2 id="Problem-b"><a href="#Problem-b" class="headerlink" title="Problem(b)"></a>Problem(b)</h2><p> Propose a superscalar strategy (maximum 2 instruction per fetch), and calculate how many cycles needed. Compare the utilization ratio with and without the superscalar strategy.</p>
<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><h2 id="Problem-a-1"><a href="#Problem-a-1" class="headerlink" title="Problem(a)"></a>Problem(a)</h2><p> This problem is essentially a matrix block problem, which is very common in the data mapping process of neural network accelerators——The memory on chip is not sufficient, so we have to divide the activation into many tile and calculate each tile orderly.Depending on the split ways, I provide two methods to deal with the problem a.</p>
<h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution(1)"></a>Solution(1)</h3><p>At first, we split three  $8\times8$ matrices A B C into 48 vectors which has 4 implements. Because it can match the DCM vector and Vector reg file bitwidth (32b).Matrix A is divided horizontally, and matrix B is divided vertically, just as the order of calculation.And we distinguish them by H and L,which is also easily for us to annotate assembly code.Each input vectors are stored in DCM vector. So the  $8\times8$ matrices calculation can be display as follow(The order of matrices C and S depends on the split methods of matrix B):</p>
<p>$$<br> \left[<br> \begin{matrix}<br>   A1H &amp; A1L \\<br>   A2H &amp; A2L \\<br>   A3H &amp; A3L \\<br>   A4H &amp; A4L \\<br>   A5H &amp; A5L \\<br>   A6H &amp; A6L \\<br>   A7H &amp; A7L \\<br>   A8H &amp; A8L<br>  \end{matrix}<br>  \right] *<br>   \left[<br> \begin{matrix}<br>   B1H &amp; B2H &amp; B3H &amp; B4H &amp; B5H &amp; B6H &amp; B7H &amp; B8H\\<br>   B1L &amp; B2L &amp; B3L &amp; B4L &amp; B5L &amp; B6L &amp; B7L &amp; B8L<br>  \end{matrix}<br>  \right] \\ +<br>  \left[<br> \begin{matrix}<br>   C1H &amp; C1L \\<br>   C2H &amp; C2L \\<br>   C3H &amp; C3L \\<br>   C4H &amp; C4L \\<br>   C5H &amp; C5L \\<br>   C6H &amp; C6L \\<br>   C7H &amp; C7L \\<br>   C8H &amp; C8L<br>  \end{matrix}<br>  \right] =<br>  \left[<br> \begin{matrix}<br>   S1H &amp; S1L \\<br>   S2H &amp; S2L \\<br>   S3H &amp; S3L \\<br>   S4H &amp; S4L \\<br>   S5H &amp; S5L \\<br>   S6H &amp; S6L \\<br>   S7H &amp; S7L \\<br>   S8H &amp; S8L<br>  \end{matrix}<br>  \right]<br>$$<br>In instructions, vrd and vrs only have 3bit which is not sufficient for 48 vectors indexing in vector reg file. But we know that, the vectors of same type are stored in contiguous address memory. So we store the base address of input vectors -activation A, weight B and bias C in Scalar reg file, and mark all of them as RF1, RF2, RF3 easily. The same, we need restore the sum vector in DCM vector, and the base address is stored in Scalar reg file called RF4.</p>
<p>In this way, we can use the Vload and Vstore instructions and index vectors by stored base address RF1,RF2 and Immediate.However, we use weight stationary to get over memory Wall, 8 indexed vector reg file is not sufficient. We cannot store all the weight in the DCM(8),so I split the weight matrix B into 4 part furthermore like this:</p>
<p>$$<br>\left[<br> \begin{matrix}<br>   B1H &amp; B2H &amp; B3H &amp; B4H<br>  \end{matrix}<br>  \right]\<br>$$<br>$$<br>\left[<br> \begin{matrix}<br>   B5H &amp; B6H &amp; B7H &amp; B8H<br>  \end{matrix}<br>\right]<br>$$<br>$$<br>\left[<br> \begin{matrix}<br>   B1L &amp; B2L &amp; B3L &amp; B4L<br>  \end{matrix}<br>  \right]\<br>$$<br>$$<br>\left[<br> \begin{matrix}<br>  B5L &amp; B6L &amp; B7L &amp; B8L<br>  \end{matrix}<br>\right]<br>$$</p>
<p>Besides, we calculate matrix S twice depended on the partitioned matrix A.<br>In a word,my design assembly code looks like this :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Step1:load the weight</span><br><span class="line">&#x2F;&#x2F; Matric B split1</span><br><span class="line">Vload  VRF1,  RF2,  $0                        &#x2F;&#x2F;load B1H</span><br><span class="line">Vload  VRF2,  RF2,  $1                        &#x2F;&#x2F;load B2H</span><br><span class="line">Vload  VRF3,  RF2,  $2                        &#x2F;&#x2F;load B3H</span><br><span class="line">Vload  VRF4,  RF2,  $3                        &#x2F;&#x2F;load B4H</span><br><span class="line">&#x2F;&#x2F; Step2: Initial Bias</span><br><span class="line">Vload  VRF5,  RF3,  $0                        &#x2F;&#x2F;load C1H</span><br><span class="line">VMAC   VRF8,  VRF5,  &#x2F;,  $1000                 &#x2F;&#x2F;Add C1H</span><br><span class="line">&#x2F;&#x2F; Step3: Computing</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VMAC   \   ,  VRF1, VRF5, $0000               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF2, VRF5, $0001               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF3, VRF5, $0010               &#x2F;&#x2F;</span><br><span class="line">VMAC   VRF8,  VRF4, VRF5, $0111               &#x2F;&#x2F;Partial S1H&#x3D;A1H * BiH + C1H</span><br><span class="line">VStore $0  ,   RF4, VRF8                      &#x2F;&#x2F;store partial S1H</span><br><span class="line">&#x2F;&#x2F;Then we cycle above 2 steps 8 times till A8H</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">&#x2F;&#x2F; Step2: Initial Bias</span><br><span class="line">Vload  VRF5,  RF3,  $7                        &#x2F;&#x2F;C8H</span><br><span class="line">VMAC   VRF8,  VRF5,  &#x2F;,  $1000                &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F; Step3: Computing</span><br><span class="line">Vload  VRF5,  RF1,  $7                        &#x2F;&#x2F;A8H</span><br><span class="line">VMAC   \   ,  VRF1, VRF5, $0000               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF2, VRF5, $0001               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF3, VRF5, $0010               &#x2F;&#x2F;</span><br><span class="line">VMAC   VRF8,  VRF4, VRF5, $0111               &#x2F;&#x2F;Partial S8H</span><br><span class="line">VStore $7  ,   RF4, VRF8</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Step1:exchange the weight B, Bias C and Psum S</span><br><span class="line">Vload  VRF1,  RF2,  $4                        &#x2F;&#x2F;B4H</span><br><span class="line">Vload  VRF2,  RF2,  $5                        &#x2F;&#x2F;B5H</span><br><span class="line">Vload  VRF3,  RF2,  $6                        &#x2F;&#x2F;B6H</span><br><span class="line">Vload  VRF4,  RF2,  $7                        &#x2F;&#x2F;B7H</span><br><span class="line"></span><br><span class="line"> &#x2F;&#x2F; Step2: Initial Bias</span><br><span class="line">Vload  VRF5,  RF3,  $8                        &#x2F;&#x2F;C1L</span><br><span class="line">VMAC   VRF8,  VRF5,  &#x2F;,  $1000                 &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F; Step3: Computing</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;A1H</span><br><span class="line">VMAC   \   ,  VRF1, VRF5, $0000               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF2, VRF5, $0001               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF3, VRF5, $0010               &#x2F;&#x2F;</span><br><span class="line">VMAC   VRF8,  VRF4, VRF5, $0111               &#x2F;&#x2F;Partial S1L</span><br><span class="line">VStore $8  ,   RF4, VRF8</span><br><span class="line">&#x2F;&#x2F;Then we cycle above 2 steps 8 times till A8H</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">&#x2F;&#x2F; Step2: Initial Bias</span><br><span class="line">Vload  VRF5,  RF3,  $15                       &#x2F;&#x2F;C8L</span><br><span class="line">VMAC   VRF8,  VRF5,  &#x2F;,  $1000                 &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F; Step3: Computing</span><br><span class="line">Vload  VRF5,  RF1,  $7                        &#x2F;&#x2F;A8H</span><br><span class="line">VMAC   \   ,  VRF1, VRF5, $0000               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF2, VRF5, $0001               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF3, VRF5, $0010               &#x2F;&#x2F;</span><br><span class="line">VMAC   VRF8,  VRF4, VRF5, $0111               &#x2F;&#x2F;Partial S8L</span><br><span class="line">VStore $15  ,   RF4, VRF8</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Step1:exchange the weight B and Psum S</span><br><span class="line">Vload  VRF1,  RF2,  $8                        &#x2F;&#x2F;B1L</span><br><span class="line">Vload  VRF2,  RF2,  $9                        &#x2F;&#x2F;B2L</span><br><span class="line">Vload  VRF3,  RF2,  $10                       &#x2F;&#x2F;B3L</span><br><span class="line">Vload  VRF4,  RF2,  $11                       &#x2F;&#x2F;B4L</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Step4: Reload Psum</span><br><span class="line">Vload  VRF5,  RF4,  $0                       &#x2F;&#x2F;load Partial S1H &#x3D; A1H * BiH + C1H</span><br><span class="line">VMAC   VRF8,  VRF5,  &#x2F;,  $1000                &#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Step3: Computing</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;A1L</span><br><span class="line">VMAC   \   ,  VRF1, VRF5, $0000               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF2, VRF5, $0001               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF3, VRF5, $0010               &#x2F;&#x2F;</span><br><span class="line">VMAC   VRF8,  VRF4, VRF5, $0111               &#x2F;&#x2F;All S1H</span><br><span class="line">VStore $0  ,   RF4, VRF8</span><br><span class="line">&#x2F;&#x2F;Then we cycle above 2 steps 8 times till A8H</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">&#x2F;&#x2F; Step4: Reload Psum</span><br><span class="line">Vload  VRF5,  RF3,  $7                       &#x2F;&#x2F;Parial S8H</span><br><span class="line">VMAC   VRF8,  VRF5,  &#x2F;,  $1000                 &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F; Step3: Computing</span><br><span class="line">Vload  VRF5,  RF1,  $7                        &#x2F;&#x2F;A8L</span><br><span class="line">VMAC   \   ,  VRF1, VRF5, $0000               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF2, VRF5, $0001               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF3, VRF5, $0010               &#x2F;&#x2F;</span><br><span class="line">VMAC   VRF8,  VRF4, VRF5, $0111               &#x2F;&#x2F;All S8H</span><br><span class="line">VStore $7  ,   RF4, VRF8</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Step1:exchange the weight B and Psum S</span><br><span class="line">Vload  VRF1,  RF2,  $13                       &#x2F;&#x2F;B5L</span><br><span class="line">Vload  VRF2,  RF2,  $14                       &#x2F;&#x2F;B6L</span><br><span class="line">Vload  VRF3,  RF2,  $15                       &#x2F;&#x2F;B7L</span><br><span class="line">Vload  VRF4,  RF2,  $16                       &#x2F;&#x2F;B8L</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Step4: Reload Psum</span><br><span class="line">Vload  VRF5,  RF4,  $8                       &#x2F;&#x2F;Parial S1L</span><br><span class="line">VMAC   VRF8,  VRF5,  &#x2F;,  $1000                &#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Step3: Computing</span><br><span class="line">Vload  VRF5,  RF1,  $8                        &#x2F;&#x2F;A1L</span><br><span class="line">VMAC   \   ,  VRF1, VRF5, $0000               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF2, VRF5, $0001               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF3, VRF5, $0010               &#x2F;&#x2F;</span><br><span class="line">VMAC   VRF8,  VRF4, VRF5, $0111               &#x2F;&#x2F;All S1L</span><br><span class="line">VStore $8  ,   RF4, VRF8</span><br><span class="line">&#x2F;&#x2F;Then we cycle above 2 steps 8 times till A8H</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">&#x2F;&#x2F; Step4: Reload Psum</span><br><span class="line">Vload  VRF5,  RF3,  $15                       &#x2F;&#x2F;Parial S8L</span><br><span class="line">VMAC   VRF8,  VRF5,  &#x2F;,  $1000                 &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F; Step3: Computing</span><br><span class="line">Vload  VRF5,  RF1,  $15                       &#x2F;&#x2F;A8L</span><br><span class="line">VMAC   \   ,  VRF1, VRF5, $0000               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF2, VRF5, $0001               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF3, VRF5, $0010               &#x2F;&#x2F;</span><br><span class="line">VMAC   VRF8,  VRF4, VRF5, $0111               &#x2F;&#x2F;All S8L</span><br><span class="line">VStore $15  ,   RF4, VRF8</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>It’s worthy adding that the assembly code include 4 big cycles and 8 small cycles , in actual situation, we can replace them by callq , jz and loop to simply the code.</p>
<p>Besides, we can calculate that,number of DCM fetches is 112:<br>Matrix A: 8 * 4 load<br>Matrix B: 4 * 4 load<br>Matrix C: 8 * 2 load<br>Matrix S: 8 * 2 * 2 store 8 * 2 load</p>
<p>And this block matrix can be expand with the increasing of matrices’ size.</p>
<h3 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution(2)"></a>Solution(2)</h3><p>As described in the above method, we have to reload each elements of matrix A from DCM vector twice. Besides, the matrix sum also need to reload once and store twice to complete twice MAC. So I change the split matrices methods, and in this method, the matrix sum only need store once.</p>
<p>The 48 input vectors are divided as follow:</p>
<p>$$<br> \left[<br> \begin{matrix}<br>   A1H &amp; A1L \\<br>   A2H &amp; A2L \\<br>   A3H &amp; A3L \\<br>   A4H &amp; A4L \\<br>   A5H &amp; A5L \\<br>   A6H &amp; A6L \\<br>   A7H &amp; A7L \\<br>   A8H &amp; A8L<br>  \end{matrix}<br>  \right] *<br>   \left[<br> \begin{matrix}<br>   B1H &amp; B2H &amp; B3H &amp; B4H &amp; B5H &amp; B6H &amp; B7H &amp; B8H\\<br>   B1L &amp; B2L &amp; B3L &amp; B4L &amp; B5L &amp; B6L &amp; B7L &amp; B8L<br>  \end{matrix}<br>  \right]<br>  +<br>$$<br>$$<br>  \left[<br> \begin{matrix}<br>    C1H &amp; C2H &amp; C3H &amp; C4H\\<br>    C5H &amp; C6H &amp; C7H &amp; C8H\\<br>    C1L &amp; C2L &amp; C3L &amp; C4L\\<br>    C5L &amp; C6L &amp; C7L &amp; C8L<br>  \end{matrix}<br>  \right] =<br>  \left[<br> \begin{matrix}<br>    S1H &amp; S2H &amp; S3H &amp; S4H\\<br>    S5H &amp; S6H &amp; S7H &amp; S8H\\<br>    S1L &amp; S2L &amp; S3L &amp; S4L\\<br>    S5L &amp; S6L &amp; S7L &amp; S8L<br>  \end{matrix}<br>  \right]<br> $$<br> I still hold on the weight stationary,so the matrix B is divided in four parts.<br>But this way I split the weight matrix B into 4 parts spanning multiple lines like this:<br>$$<br>\left[<br> \begin{matrix}<br>   B1H &amp; B2H\\<br>   B1L &amp; B2L<br>  \end{matrix}<br>  \right]<br>\left[<br> \begin{matrix}<br>   B3H &amp; B4H \\<br>   B3L &amp; B4L<br>  \end{matrix}<br>\right]<br>\left[<br> \begin{matrix}<br>   B5H &amp; B6H \\<br>   B5L &amp; B6L<br>  \end{matrix}<br>  \right]<br>\left[<br> \begin{matrix}<br>  B7H &amp; B8H \\<br>  B7L &amp; B8L<br>  \end{matrix}<br>\right]<br>$$<br>So the cycle calculation is a little different from the method a.<br>In a word,my design assembly code looks like this :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">Vload  VRF6,  RF1,  $1                        &#x2F;&#x2F;load A1L</span><br><span class="line">VMAC   \   ,  VRF3, VRF6, $0000               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF4, VRF6, $0001               &#x2F;&#x2F;Partial S1H&#x3D;A1H * BiH + A1L * BiL + C1H</span><br><span class="line"></span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A2H</span><br><span class="line">VMAC   \   ,  VRF1, VRF5, $0010               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF2, VRF5, $0011               &#x2F;&#x2F;</span><br><span class="line">Vload  VRF6,  RF1,  $1                        &#x2F;&#x2F;load A2L</span><br><span class="line">VMAC   \   ,  VRF3, VRF6, $0010               &#x2F;&#x2F;</span><br><span class="line">VMAC   VRF8,  VRF4, VRF6, $0111               &#x2F;&#x2F;All S1H&#x3D;AiH * BiH + AiL * BiL + C1H</span><br><span class="line">VStore $0  ,   RF4, VRF8                      &#x2F;&#x2F;store S1H</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;Then we cycle above 2 steps 4 times till A8H</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;Change the matrix weight B other 3 splits</span><br><span class="line">&#x2F;&#x2F;Repeat above 4 small cycles</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Step1:load the weight</span><br><span class="line">&#x2F;&#x2F; Matric B split1</span><br><span class="line">Vload  VRF1,  RF2,  $0                        &#x2F;&#x2F;load B7H</span><br><span class="line">Vload  VRF2,  RF2,  $1                        &#x2F;&#x2F;load B8H</span><br><span class="line">Vload  VRF3,  RF2,  $2                        &#x2F;&#x2F;load B7L</span><br><span class="line">Vload  VRF4,  RF2,  $3                        &#x2F;&#x2F;load B8L</span><br><span class="line">&#x2F;&#x2F; Step2: Initial Bias</span><br><span class="line">Vload  VRF5,  RF3,  $0                        &#x2F;&#x2F;load C4H</span><br><span class="line">VMAC   VRF8,  VRF5,  &#x2F;,  $1000                 &#x2F;&#x2F;Add C4H</span><br><span class="line">&#x2F;&#x2F; Step3: Computing</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VMAC   \   ,  VRF1, VRF5, $0000               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF2, VRF5, $0001               &#x2F;&#x2F;</span><br><span class="line">Vload  VRF6,  RF1,  $1                        &#x2F;&#x2F;load A1L</span><br><span class="line">VMAC   \   ,  VRF3, VRF6, $0000               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF4, VRF6, $0001               &#x2F;&#x2F;Partial S1H&#x3D;A1H * BiH + A1L * BiL + C1H</span><br><span class="line"></span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A2H</span><br><span class="line">VMAC   \   ,  VRF1, VRF5, $0010               &#x2F;&#x2F;</span><br><span class="line">VMAC   \   ,  VRF2, VRF5, $0011               &#x2F;&#x2F;</span><br><span class="line">Vload  VRF6,  RF1,  $1                        &#x2F;&#x2F;load A2L</span><br><span class="line">VMAC   \   ,  VRF3, VRF6, $0010               &#x2F;&#x2F;</span><br><span class="line">VMAC   VRF8,  VRF4, VRF6, $0111               &#x2F;&#x2F;All S1H&#x3D;AiH * BiH + AiL * BiL + C1H</span><br><span class="line">VStore $0  ,   RF4, VRF8                      &#x2F;&#x2F;store S1H</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;Then we cycle above 2 steps 4 times till A8H</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">•</span><br></pre></td></tr></table></figure>
<p>Although the matrix sum only store once, in this method, we have to load matrix A fourth to complete MAC. So we can calculate that,number of DCM fetches is 112,too:<br>Matrix A: 16 * 4 load<br>Matrix B: 4 * 4 load<br>Matrix C: 4 * 4 load<br>Matrix S: 4 * 4 store<br>Of coarse, there are many other functions such as based on actvation stationary or output stationary. Whatever,choose the reasonable splited methods to balance memory wall and latency depends your own situation.</p>
<h2 id="Problem-b-1"><a href="#Problem-b-1" class="headerlink" title="Problem(b)"></a>Problem(b)</h2><p><img src="wavedrom1.png" alt="customed pipeline instructions waveform"><br>Based on function 1,we proposed a superscalar strategy. As I said above, this method include 4 big cycles and 8 small cycles, so I just analyze the non-repeated instruction parallelism.</p>
<p>Assumed that ,all steps cost the same time.</p>
<p>As Figure 1,in customed pipeline,we have 4 big cycles and each big cycle has 8 small cycles.<br>And we can figure that,the small cycles’ throughout is 11 cycles.Combined above, we can calculate the throughout of whole assembly code:<br> $$<br> ((8 * (11 - 2) + 2 + 4) - 2) * 4 + 2 = 306 clks<br> $$<br>Before superscalar strategy, we assumed that, the DCM vector is TrueDualPortRam. Or we can design two DCM to store for weight and activation data seperatly. In other words, we can load or store two vectors based on different address at the same time.</p>
<p>And Based on Lecture 4, we use the Load+Mac instruction. In other words, we proposed a LoMac instruction to complete two function in 5 cycles.But it must execute with a load instruction at the same time.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Vload   Vrd(3b),  rs1(5b),  imm(5b)</span><br><span class="line">VloMac  Vrd(3b),  rs2(5b),  imm(1b), funct(4b)</span><br></pre></td></tr></table></figure>
<p>Therefore, most load and LoMac instruction can be run in parallel. But the step2/4(initial bias/reload psum) and MAC in small cycle might cause data hazard. So we have to execute two instructions separately.</p>
<p>And the Step1(load weight) can be combined with Step3(Computing).But cause the VloMac only have imm(1b), so We add more base scalar RF to store base address. Specifically, RF1 and RF3 still works for matrix A and C.RF2 is for Psum. Matrix B need RF4 to RF11 to index. The depth of scalar RF is 32, so it’s enough.<br>The improving assembly code show follow:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Step2: Initial Bias</span><br><span class="line">Vload  VRF5,  RF3,  $0                        &#x2F;&#x2F;load C1H</span><br><span class="line">VLoMac VRF8,  \  ,  \,  $1000                 &#x2F;&#x2F;Add C1H</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Step3: Combine load weight and Computing</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VloMac \   ,  RF4,  $0,  $0000                &#x2F;&#x2F;load B1H and Mac A1H and B1H</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VloMac \   ,  RF4,  $1,  $0001                &#x2F;&#x2F;load B2H and Mac A1H and B2H</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VloMac \   ,  RF5,  $0,  $0010                &#x2F;&#x2F;load B3H and Mac A1H and B3H</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VloMac VRF8,  RF5,  $1,  $0111                &#x2F;&#x2F;load B4H and Mac A1H and B4H</span><br><span class="line">VStore $0  ,   RF2, VRF8                      &#x2F;&#x2F;store partial S1H</span><br><span class="line">&#x2F;&#x2F;Then we cycle above step 8 times till A8H</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">&#x2F;&#x2F; Step2: Initial Bias</span><br><span class="line">Vload  VRF5,  RF3,  $7                        &#x2F;&#x2F;load C8H</span><br><span class="line">VLoMac VRF8,  \  ,  \,  $1000                 &#x2F;&#x2F;Add C8H</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Step3: Combine load weight and Computing</span><br><span class="line">Vload  VRF5,  RF1,  $1                        &#x2F;&#x2F;load A8H</span><br><span class="line">VloMac \   ,  RF4,  $0,  $0000                &#x2F;&#x2F;load B1H and Mac A8H and B1H</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VloMac \   ,  RF4,  $1,  $0001                &#x2F;&#x2F;load B2H and Mac A8H and B2H</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VloMac \   ,  RF5,  $0,  $0010                &#x2F;&#x2F;load B3H and Mac A8H and B3H</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VloMac VRF8,  RF5,  $1,  $0111                &#x2F;&#x2F;load B4H and Mac A8H and B4H</span><br><span class="line">VStore $7  ,   RF2, VRF8                      &#x2F;&#x2F;store partial S8H</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;Step2: exchange the weight B, Bias C and Psum S</span><br><span class="line"></span><br><span class="line">Vload  VRF5,  RF3,  $8                        &#x2F;&#x2F;load C1L</span><br><span class="line">VLoMac VRF8,  \  ,  \,  $1000                 &#x2F;&#x2F;Add C1L</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Step3: Combine load weight and Computing</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VloMac \   ,  RF6,  $0,  $0000                &#x2F;&#x2F;load B1H and Mac A1H and B1H</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VloMac \   ,  RF6,  $1,  $0001                &#x2F;&#x2F;load B2H and Mac A1H and B2H</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VloMac \   ,  RF7,  $0,  $0010                &#x2F;&#x2F;load B3H and Mac A1H and B3H</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VloMac VRF8,  RF7,  $1,  $0111                &#x2F;&#x2F;load B4H and Mac A1H and B4H</span><br><span class="line">VStore $0  ,   RF2, VRF8                      &#x2F;&#x2F;store partial S1L</span><br><span class="line">&#x2F;&#x2F;Then we cycle above step 8 times till A8H</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">&#x2F;&#x2F; Step2: Initial Bias</span><br><span class="line">Vload  VRF5,  RF3,  $15                       &#x2F;&#x2F;load C8L</span><br><span class="line">VLoMac VRF8,  \  ,  \,  $1000                 &#x2F;&#x2F;Add C8L</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Step3: Combine load weight and Computing</span><br><span class="line">Vload  VRF5,  RF1,  $1                        &#x2F;&#x2F;load A8H</span><br><span class="line">VloMac \   ,  RF6,  $0,  $0000                &#x2F;&#x2F;load B1H and Mac A8H and B1H</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VloMac \   ,  RF6,  $1,  $0001                &#x2F;&#x2F;load B2H and Mac A8H and B2H</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VloMac \   ,  RF7,  $0,  $0010                &#x2F;&#x2F;load B3H and Mac A8H and B3H</span><br><span class="line">Vload  VRF5,  RF1,  $0                        &#x2F;&#x2F;load A1H</span><br><span class="line">VloMac VRF8,  RF7,  $1,  $0111                &#x2F;&#x2F;load B4H and Mac A8H and B4H</span><br><span class="line">VStore $7  ,   RF2, VRF8                      &#x2F;&#x2F;store partial S8L</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">•</span><br><span class="line">&#x2F;&#x2F;The same for 4 cycles, except that, we don&#39;t need matrix C to the Psum,</span><br><span class="line">&#x2F;&#x2F;But we reload the calculated Psum as the initial Bias.</span><br><span class="line">&#x2F;&#x2F;Refer to the assembly code in Page 4 for details.</span><br></pre></td></tr></table></figure>
<p>As Figure 2,we have 4 big cycles and each big cycle only has 8 small cycles with superscalar strategy.<br>And we can figure that,the small cycles’ throughout is 9 cycles without VStore. And we have to stall the pipeline 3 cycles for VStore. And this instruction, we cannot realize superscalar.However, just like the yellow rectangle, we can run next cycles’ instruction. And I confirm that if we change the VRF for Psum, we can avoid the data hazard. Combined above, we can calculate the throughout of whole assembly code:<br> $$<br> (8 * (9 - 4) + 8) * 4 - 1 + 6\ =\ 197 clks<br> $$<br>$$<br>Before\ Superscalar: 5 * 8 * 4 / 306\ =\ 52.29%<br>$$<br>$$<br>After\ Superscalar: 5 * 8 * 4 / 197\ =\ 81.22%<br> $$<br> In this work, we assumed that all step cost the same time. But in reality, ALU-MAC costs much more longer than others, so superscalar strategy could improve the pipeline latency significantly.<br><img src="wavedrom2.png" alt="Superscalar strategy instructions waveform"><br>In this system,we realize a MAC module based on the circuit showed in Problem1.The source code was written by SystemVerilog called mac.sv. And the interface of MAC module was showed follow:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">module mac(</span><br><span class="line">    input logic clk,</span><br><span class="line">    input logic [31:0]in1,</span><br><span class="line">    input logic [31:0]in2,</span><br><span class="line">    input logic [3:0]func,</span><br><span class="line">    output logic [31:0] out</span><br><span class="line"></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>We also submit the complete source code in the attachment.And the testbench  called tb_mac.sv was attached, too. In the testbench, we realize the maxtrix MAC.<br>$$<br> \left[<br> \begin{matrix}<br>   -1 &amp; 2 &amp; -3 &amp; 4 \\<br>  \end{matrix}<br>  \right] *<br>   \left[<br> \begin{matrix}<br>   -1 &amp; -1 &amp; 0 &amp; 2 \\<br>   2  &amp;  2 &amp; 3 &amp; 1 \\<br>   3  &amp; -3 &amp; 1 &amp; 4 \\<br>   4  &amp;  4 &amp; 2 &amp; 5<br>  \end{matrix}<br>  \right] +<br>  \left[<br> \begin{matrix}<br>   1 &amp; 2 &amp; 3 &amp; 4 \\<br>  \end{matrix}<br>  \right]<br>  =<br>  \left[<br> \begin{matrix}<br>   13 &amp; 32 &amp; 14 &amp; 12 \\<br>  \end{matrix}<br>  \right]<br>$$<br><img src="waveform.jpg" alt="VMAC module waveform"><br>In Figure3, we realize 5 VMAC instructions to complete the matrix calculation. The final out is a splicing of 4 quantized results in scratchpad of MAC.$0c\ 0e\ 20\ 0d$ is the hexadecimal of result of $12\ 14\ 32\ 13$.We have reached the expected functional goal.The specific source code just like the mac.sv and tb_mac.sv in appendix.I also attached a screenshot of the simulation waveform.</p>
<p>  ******Believe me, Support me, Pay me!******<br>⬇︎</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>CA-HW-2</p><p><a href="https://desirable98.github.io/2021/04/30/CA-HW-2/">https://desirable98.github.io/2021/04/30/CA-HW-2/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>XinRu Jia</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-04-30</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2021-05-05</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/img/IMG_2884.JPG" alt="Alipay"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/img/IMG_2883.JPG" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/04/30/CA-HW-3/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">CA-HW-3</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/04/30/CA-HW-1/"><span class="level-item">CA-HW-1</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/JXR.JPG" alt="Xinru Jia"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Xinru Jia</p><p class="is-size-6 is-block">IC Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Pudong, Shanghai, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">6</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/desirable98" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/desirable98"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Mail" href="mailto:Jiaxinru_98@163.com"><i class="fas fa-envelope"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#HW-2"><span class="level-left"><span class="level-item">1</span><span class="level-item">HW_2</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Problem-a"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">Problem(a)</span></span></a></li><li><a class="level is-mobile" href="#Problem-b"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">Problem(b)</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Solution"><span class="level-left"><span class="level-item">2</span><span class="level-item">Solution</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Problem-a-1"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Problem(a)</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Solution-1"><span class="level-left"><span class="level-item">2.1.1</span><span class="level-item">Solution(1)</span></span></a></li><li><a class="level is-mobile" href="#Solution-2"><span class="level-left"><span class="level-item">2.1.2</span><span class="level-item">Solution(2)</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Problem-b-1"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Problem(b)</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Computer-and-Intelligent-Processor-Architecture/"><span class="level-start"><span class="level-item">Computer and Intelligent Processor Architecture</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/KWS/"><span class="level-start"><span class="level-item">KWS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><figure class="media-left"><a class="image" href="/2021/05/19/Zhutmost-and-his-little-cute/"><img src="/img/1.jpg" alt="Zhutmost and his little cute"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-05-19T12:18:01.000Z">2021-05-19</time></p><p class="title"><a href="/2021/05/19/Zhutmost-and-his-little-cute/">Zhutmost and his little cute</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/04/30/CA-HW-3/"><img src="/img/4.jpg" alt="CA-HW-3"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-04-30T10:00:29.000Z">2021-04-30</time></p><p class="title"><a href="/2021/04/30/CA-HW-3/">CA-HW-3</a></p><p class="categories"><a href="/categories/Computer-and-Intelligent-Processor-Architecture/">Computer and Intelligent Processor Architecture</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/04/30/CA-HW-2/"><img src="/img/3.jpg" alt="CA-HW-2"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-04-30T09:48:18.000Z">2021-04-30</time></p><p class="title"><a href="/2021/04/30/CA-HW-2/">CA-HW-2</a></p><p class="categories"><a href="/categories/Computer-and-Intelligent-Processor-Architecture/">Computer and Intelligent Processor Architecture</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/04/30/CA-HW-1/"><img src="/img/2.jpg" alt="CA-HW-1"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-04-30T00:11:55.000Z">2021-04-30</time></p><p class="title"><a href="/2021/04/30/CA-HW-1/">CA-HW-1</a></p><p class="categories"><a href="/categories/Computer-and-Intelligent-Processor-Architecture/">Computer and Intelligent Processor Architecture</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/04/30/Computer-and-Intelligent-Processor-Architecture/"><img src="/img/1.jpg" alt="Computer and Intelligent Processor Architecture"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-04-30T00:11:55.000Z">2021-04-30</time></p><p class="title"><a href="/2021/04/30/Computer-and-Intelligent-Processor-Architecture/">Computer and Intelligent Processor Architecture</a></p><p class="categories"><a href="/categories/Computer-and-Intelligent-Processor-Architecture/">Computer and Intelligent Processor Architecture</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">May 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">April 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/IMG_2210.JPG" alt="Xinru Jia&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2021 XinRu Jia</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/desirable98"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>